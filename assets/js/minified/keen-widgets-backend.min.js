!function(c){KeenWidgets={init:function(){this._init_colorpicker(),this._init_repeater(),this._getMarkup(),this._bind()},_init_colorpicker:function(){c(".keen-widget-field-color input").wpColorPicker({change:function(e,t){}})},_bind:function(){c(document).on("widget-updated widget-added",KeenWidgets._reinit_controls),c(document).on("click",".keen-select-icon",KeenWidgets._icon_selector),c(document).on("click",".keen-widget-icon",KeenWidgets._set_icon),c(document).on("click",".keen-repeater-sortable .clone",KeenWidgets._repeater_clone),c(document).on("click",".keen-repeater-sortable .remove",KeenWidgets._repeater_remove),c(document).on("click",".keen-repeater-field .actions",KeenWidgets._repeater_toggle_open),c(document).on("click",".keen-repeater .add-new-btn",KeenWidgets._add_new),c(document).on("click",".widget-control-save",KeenWidgets._repeater_reinit),c(document).on("click",".keen-repeater-field .keen-select-image",KeenWidgets._repeater_add_image_field),c(document).on("click",".keen-repeater-field .keen-remove-image",KeenWidgets._repeater_remove_image_field),c(document).on("input",'.keen-repeater-field [data-field-id="title"]',KeenWidgets._repeater_set_title),c(document).on("keyup",".keen-repeater-field .search-icon",KeenWidgets._searchFuntionality),c(document).on("click",".keen-repeater-field .keen-select-icon",KeenWidgets._showIconsMarkup)},_reinit_controls:function(){KeenWidgets._init_colorpicker(),KeenWidgets._init_repeater()},_getMarkup:function(){var e=fontAwesomeIcons.font_awesome,t='<input type="search" placeholder="Search icon..." class="search-icon">';for(var a in t+='<ul class="keen-widget-icons-list">',e)if(e.hasOwnProperty(a)){var s=e[a],i=s.svg.hasOwnProperty("brands")?s.svg.brands.viewBox:s.svg.solid.viewBox,r=s.svg.hasOwnProperty("brands")?s.svg.brands.path:s.svg.solid.path,n=i.join(" "),o=s.search.terms.join(" ");s.search.terms.push(a),s.search.terms.push(s.styles[0]),t+='<li class="keen-widget-icon '+a+'" data-search-terms="'+o+'" data-font="'+a+'" data-viewbox="'+n+'" data-path="'+r+'">',t+='<svg xmlns="http://www.w3.org/2000/svg" viewBox="'+n+'"><path d="'+r+'"></path></svg>',t+="</li>"}return t+="</ul>"},_showIconsMarkup:function(){font_awesome_markup=KeenWidgets._getMarkup(),c(this).hasClass("open")?c(this).parents(".keen-widget-icon-selector").find(".keen-icons-list-wrap").append(font_awesome_markup):(c(this).parents(".keen-widget-icon-selector").find(".keen-widget-icons-list").remove(),c(this).parents(".keen-widget-icon-selector").find(".search-icon").remove())},_icon_selector:function(e){c(this).parents(".keen-widget-icon-selector").find(".keen-icons-list-wrap").slideToggle(),c(this).toggleClass("open")},_set_icon:function(e){var t=c(this).parents(".keen-widget-icon-selector"),a=c(this).attr("data-font")||"",s=t.find(".keen-widget-icon."+a),i=t.find(".keen-selected-icon"),r=t.find(".selected-icon"),n=c(this).attr("data-path"),o=c(this).attr("data-viewbox"),d=s.html();i.html(d),t.find(".keen-widget-icons-list .keen-widget-icon").removeClass("selected"),s.addClass("selected"),"yes"===c(this).closest(".keen-repeater-field").find(".selected-icon").data("icon-visible")&&(c(this).closest(".keen-repeater-field").find(".title").attr("class","title"),c(this).closest(".keen-repeater-field").find(".title").addClass(a)),iconObj={name:a,path:n,viewbox:o};var l=JSON.stringify(iconObj);r.val(l),t.find(".selected-icon").trigger("change")},_searchFuntionality:function(){var e,t,a,s;e=this.value.toUpperCase(),t=c(this).parents(".keen-icons-list-wrap").find(".keen-widget-icons-list")[0],console.log(t),setTimeout(function(){for(a=t.getElementsByTagName("li"),s=0;s<a.length;s++)search=c(a[s]).data("search-terms"),search&&(-1<search.toUpperCase().indexOf(e)?a[s].style.display="":a[s].style.display="none")},300)},_repeater_remove_image_field:function(e){if(confirm("Do you want to remove this image?")){var t=c(this).parents(".keen-repeater-field");t.find(".keen-field-image-preview").html(""),t.find(".keen-field-image-preview img").attr("src",""),t.find(".keen-field-image-preview-id").val(""),t.find(".keen-image-url").val(""),t.find(".keen-image-alt").val(""),t.find(".keen-image-title").val(""),t.find(".keen-image-size-select, .keen-image-width").hide()}},_repeater_add_image_field:function(e){var a=c(this).parents(".keen-repeater-field"),s=wp.media({title:"Select or Upload Image",button:{text:"Choose Image"},library:{type:"image"},multiple:!1});return s.on("close",function(){var e=s.state().get("selection").toJSON();if(!c.isEmptyObject(e)){if(e[0].sizes.hasOwnProperty("medium"))var t=e[0].sizes.medium.url;else if(e[0].sizes.hasOwnProperty("thumbnail"))t=e[0].sizes.thumbnail.url;else t=e[0].sizes.full.url;0<a.find(".keen-remove-image").length?a.find(".keen-field-image-preview img").attr("src",t):a.find(".keen-field-image-preview").append('<span class="keen-remove-image button">Remove</span><img src="'+t+'" />'),a.find(".keen-image-url").val(e[0].url),a.find(".keen-image-alt").val(e[0].alt),a.find(".keen-image-title").val(e[0].title),a.find(".keen-field-image-preview-id").val(e[0].id),a.find(".keen-image-size-select, .keen-image-width").show(),a.find("input").trigger("change")}}),s.open(),!1},_get_sub_string:function(e){var t="";if(24<e.length)t="..";return e=e.substring(0,24)+t},_repeater_set_title:function(e){var t=c(this).val()||"";t=KeenWidgets._get_sub_string(t),c(this).closest(".keen-repeater-field").find(".title").text(t)},_repeater_reinit:function(e){c(".keen-repeater-sortable").sortable()},_add_new:function(e){e.preventDefault();var t=c(this).closest(".keen-repeater"),a=c(".keen-repeater-field").length||0,s=t.find(".keen-repeater-fields").html(),i=t.find(".keen-repeater-fields").attr("title")||"",r=(t.find(".keen-repeater-fields").attr("data-id"),'<div class="keen-repeater-field">');r+='\t<div class="actions">',r+='\t<span class="index">'+a+"</span>",r+='\t\t<span class="dashicons dashicons-move"></span>',r+='\t<span class="title">'+i+"</span>",r+='\t\t<span class="dashicons dashicons-admin-page clone"></span>',r+='\t\t<span class="dashicons dashicons-trash remove"></span>',r+='\t\t<span class="dashicons toggle-arrow"></span>',r+="\t</div>",r+='\t<div class="markukp">',r+=s=s.replace("][][","]["+a+"]["),r+="\t</div>",r+="</div>",t.find(".keen-repeater-sortable").append(r),KeenWidgets._set_repeater_names()},_set_repeater_names:function(){c(".keen-repeater").each(function(e,t){var n=c(t).find(".keen-repeater-fields").attr("data-id")||"";c(t).find(".keen-repeater-sortable").find(".keen-repeater-field").each(function(i,r){c(r).find(":input").each(function(e,t){var a=c(t).attr("data-field-id")||"",s=n+"["+i+"]["+a+"]";c(r).find(".index").text(i),c(t).attr("name",s)})})})},_repeater_toggle_open:function(e){e.preventDefault(),(e.target===this||c(e.target).hasClass("title")||c(e.target).hasClass("dashicons-move"))&&(c(this).parents(".keen-repeater-field").toggleClass("field-open"),c(this).parents(".keen-repeater-field").find(".markukp").slideToggle())},_repeater_clone:function(e){e.preventDefault();var t=c(this),a=t.closest(".keen-repeater");a.find(".keen-repeater-fields").html();c(t).closest(".keen-repeater-field").clone().insertAfter(t.closest(".keen-repeater-field")),c(".keen-repeater-sortable").sortable(),a.find("input").trigger("change"),KeenWidgets._set_repeater_names()},_repeater_remove:function(e){e.preventDefault();var t=c(this),a=t.closest(".keen-repeater"),s=t.parent().find(".title").html(),i="";i=0<s.length?s:"this field",confirm("Are you sure you want to delete "+i+"?")&&t.closest(".keen-repeater-field").remove(),KeenWidgets._set_repeater_names(),a.find("input").trigger("change")},_init_repeater:function(){c(".keen-repeater-sortable").sortable({cursor:"move",stop:function(e,t){KeenWidgets._set_repeater_names(),t.item.find("input").trigger("change")}}),KeenWidgets._set_repeater_names(),c(".keen-repeater-field").length&&c(".keen-repeater-field").each(function(e,t){var a=c(t).find('[data-field-id="title"]').val()||"",s=c(t).find('[data-field-id="icon"]').val()||"";a=KeenWidgets._get_sub_string(a),c(t).find(".title").text(a),"yes"===c(t).find(".selected-icon").data("icon-visible")&&c(t).find(".title").addClass(s)})}},c(function(){KeenWidgets.init()})}(jQuery);